# 正则表达式

本文档根据提供的笔记，整理了一系列在 JavaScript 环境下使用正则表达式的实例和技巧。

## 1. 基础匹配

### 1.1 纯文本查找
直接使用字符串或简单的正则表达式进行查找。
```js
var text = 'Hello, my name is Ben. Please visit my website at http://www.forta.com/';
var n = text.match(/Ben/); // 使用 /Ben/ 效果等同于 'Ben'
```
**结果:** `["Ben"]`

### 1.2 全局匹配 (g)
使用 `g` 标志可以匹配所有出现的结果，而不仅仅是第一个。
```js
var text = 'Hello, my name is Ben. Please visit my website at http://www.forta.com/';
var n = text.match(/my/g);
```
**结果:** `["my", "my"]`

### 1.3 忽略大小写 (i)
使用 `i` 标志进行不区分大小写的匹配。
```js
var text = 'Hello, my name is Ben. Please visit my website at http://www.forta.com/';
var n = text.match(/ben/i);
```
**结果:** `["Ben"]`

## 2. 元字符的使用

### 2.1 匹配任意字符 (.)
`.` (点) 元字符可以匹配除换行符外的任意单个字符。
```js
var text = 'sales1.xls\nsales2.xls\nsales3.xls';
var n = text.match(/sales./g);
```
**结果:** `["sales1", "sales2", "sales3"]`

### 2.2 匹配特殊字符本身 (\\)
要匹配 `.`、`*`、`?` 等元字符本身，需要在其前面加上 `\` (反斜杠) 进行转义。
```js
var text = 'na1.xls\nsa1.xls\nca1.xls';
var n = text.match(/.a.\.xls/g);
```
**结果:** `["na1.xls", "sa1.xls", "ca1.xls"]`

## 3. 字符集 `[]`

### 3.1 匹配多个字符中的一个
`[abc]` 匹配 `a`、`b`、`c` 中的任意一个。
```js
var text = 'na1.xls\nsa1.xls\nca1.xls';
var n = text.match(/[ns]a.\.xls/g);
```
**结果:** `["na1.xls", "sa1.xls"]`

### 3.2 使用字符区间
`[0-9]` 匹配 0 到 9 的任意数字，`[a-z]` 匹配任意小写字母。
```js
var text = 'na1.xls\nsa2.xls';
var n = text.match(/[ns]a[0-9]\.xls/g);
```
**结果:** `["na1.xls", "sa2.xls"]`
- `[a-zA-Z0-9]` 匹配所有大小写字母和数字。
- `#[0-9A-Fa-f]{6}` 匹配一个完整的十六进制颜色值。

### 3.3 取非匹配 (^)
在字符集内部使用 `^` 表示匹配**除了**该集合内字符以外的任何字符。
```js
var text = 'na1.xls\nsam.xls';
var n = text.match(/[ns]a[^0-9]\.xls/g);
```
**结果:** `["sam.xls"]` (因为 `m` 不是数字)

## 4. 预定义元字符

| 元字符 | 描述 | 等价于 |
| :--- | :--- | :--- |
| `\d` | 匹配任意数字 | `[0-9]` |
| `\D` | 匹配任意非数字 | `[^0-9]` |
| `\w` | 匹配字母、数字、下划线 | `[a-zA-Z0-9_]` |
| `\W` | 匹配非字母、数字、下划线 | `[^a-zA-Z0-9_]` |
| `\s` | 匹配任意空白字符 | `[ \t\n\r\f\v]` |
| `\S` | 匹配任意非空白字符 | `[^ \t\n\r\f\v]` |
| `\r\n` | 匹配 Windows 风格的换行符 | |

**示例:**
```js
// 匹配 myArray
var text = 'var myArray=new Array(); if(myArray[0]==0){...}';
var n = text.match(/myArray\[\d\]/); 
```

**结果:** `["myArray[0]"]`

## 5. 量词 (Quantifiers)

### 5.1 匹配一次或多次 (+)
```js
var text = 'Send personal email to ben@forta.com.';
var n = text.match(/\w+@\w+\.\w+/g);
```
**结果:** `["ben@forta.com"]`

### 5.2 匹配零次或多次 (*)
```js
var text = 'Hello .ben@forta.com is my email address.';
var n = text.match(/\w*[\w.]*@[\w.]+\.\w+/g);
```
**结果:** `[".ben@forta.com"]`

### 5.3 匹配零次或一次 (?)
```js
var text = 'http://www.forta.com/ and https://www.forta.com/';
var n = text.match(/https?:\/\/[\w./]+/g);
```
**结果:** `["http://www.forta.com/", "https://www.forta.com/"]`

### 5.4 指定重复次数 `{n,m}`
- `{n}`: 恰好 n 次
- `{n,}`: 至少 n 次
- `{n,m}`: 至少 n 次，至多 m 次

```js
// 匹配十六进制颜色
var text = 'BGCOLOR="#336633"';
var n = text.match(/#[0-9a-fA-F]{6}/g);

// 匹配日期
var text = '4/8/03\n10-6-2004';
var n = text.match(/\d{1,2}[-/]\d{1,2}[-/]\d{2,4}/g);
```

### 5.5 防止过度匹配 (懒惰模式)
默认量词是“贪婪的”。在其后加上 `?` 可变为“懒惰”模式，进行最小化匹配。

```js
var text = 'This offer is not available to customers living in <B>AK</B> and <B>HI</B>';
// 贪婪匹配 (错误)
var greedy = text.match(/<[Bb]>.*<\/[Bb]>/g); 
// 结果: ["<B>AK</B> and <B>HI</B>"]

// 懒惰匹配 (正确)
var lazy = text.match(/<[Bb]>.*?<\/[Bb]>/g);
// 结果: ["<B>AK</B>", "<B>HI</B>"]
```

## 6. 边界匹配

### 6.1 单词边界 (`\\b`, `\\B`)
- `\b`: 匹配单词的开头或结尾（不匹配任何字符，只匹配位置）。
- `\B`: 匹配非单词边界的位置。

```js
var text = 'The cat scattered his food.';
var n = text.match(/\bcat\b/g); // 只匹配独立的单词 "cat"
```

### 6.2 字符串边界 (^, $)
- `^`: 匹配字符串的开头。
- `$`: 匹配字符串的结尾。

```js
var text = '<?xml version="1.0" ?>';
var n = text.match(/^\s*<\?xml.*\?>/g); // 确保XML声明在文件最开始
```

### 6.3 分行匹配模式 (`m`)
使用 `m` 标志，可以使 `^` 和 `$` 也能匹配每一行的开头和结尾。

**注意：** JavaScript 正则表达式没有 `(?m)` 语法，`m` 只能作为标志使用 `/.../m`。

```js
var text = '// comment 1\nvar a = 1;\n// comment 2';
var n = text.match(/^\s*\/\/.*$/gm);
```
**结果:** `["// comment 1", "// comment 2"]`

## 7. 分组与回溯引用

### 7.1 子表达式 ()

使用 `()` 将表达式分组，作为一个整体来应用量词。
```js
// 匹配连续两个或更多的 &nbsp;
var text = 'Windows&nbsp;&nbsp;2000';
var n = text.match(/(&nbsp;){2,}/);     //&nbsp;&nbsp;

// 匹配IP地址 (简化版)
var text = 'Pinging 12.159.46.200';
var n = text.match(/(\d{1,3}\.){3}\d{1,3}/g);   //12.159.46.200
```

### 7.2 回溯引用 (\\1, \\2, ...)
`\1` 引用第一个捕获组 `()` 匹配到的**内容**。
```js
// 查找重复的单词
var text = 'words here are are repeated';
var n = text.match(/[ ]+(\w+)[ ]+\1/g);  // are are

// 匹配配对的 HTML 标签
var text = '<H1>Welcome</H1>...<H2>Invalid</H3>';
var n = text.match(/<[Hh]([1-6])>.*?<\/[Hh]\1>/g); //<H1>Welcome</H1>  
```

### 7.3 在 `replace` 中使用回溯引用 (`$1`, `$2`, ...)
在 `replace` 方法的第二个参数中，`$n` 代表第 `n` 个捕获组的内容。
```js
// 格式化电话号码
var text = '313-555-1234';
var n = text.replace(/(\d{3})-(\d{3})-(\d{4})/, '($1) $2-$3');
// 结果: "(313) 555-1234"

// 将邮件地址转为链接
var text = 'Hello, ben@forta.com is my email address';
var n = text.replace(/([\w.]+@[\w.]+\.\w+)/, '<a href="mailto:$1">$1</a>');
//'Hello, <a href="mailto:ben@forta.com">ben@forta.com</a> is my email address'
```

![Logo](/regexpThird.png)

## 8. 高级主题

### 8.1 前后查找 (Lookaround)
**注意:** JavaScript 在 ES2018 之后才完整支持向后查找。

- **`(?=...)` (正向前瞻)**: 匹配其后紧跟着 `...` 的位置。
- **`(?!...)` (负向前瞻)**: 匹配其后**不**是 `...` 的位置。
- **`(?<=...)` (正向后顾)**: 匹配其前是 `...` 的位置。
- **`(?<!...)` (负向后顾)**: 匹配其前**不**是 `...` 的位置。

```js
// 提取协议名
var text = 'http://www.forta.com/';
var n = text.match(/.+(?=:)/g);
// 结果: ["http"]

// 提取不带'$'符号的数字
var text = 'I paid $30 for 100 apples';
var n = text.match(/\b(?<!\$)\d+\b/g);
// 结果: ["100"]
```

### 8.2 嵌入条件
**注意:** JavaScript 正则表达式不支持 `(?(...)...|...)` 这种复杂的嵌入条件语法。通常需要通过多个正则表达式或逻辑代码来实现。

## 9. JavaScript 中的正则方法

| 方法 | 描述 |
| :--- | :--- |
| `regexp.test(str)` | 检测字符串是否匹配，返回 `true` 或 `false`。 |
| `regexp.exec(str)` | 检索匹配项，返回一个包含详细信息的数组，或 `null`。 |
| `str.match(regexp)` | 检索匹配项，非全局模式下行为类似 `exec`，全局模式下返回所有匹配组成的数组。 |
| `str.search(regexp)`| 检索匹配项，返回第一个匹配的**索引**，未找到则返回 `-1`。 |
| `str.replace(regexp, repl)`| 替换匹配的子字符串。 |
| `str.split(regexp)` | 使用正则表达式作为分隔符来分割字符串。 |

## 10.[正则表达式速查表](https://tool.oschina.net/uploads/apidocs/jquery/regexp.html)

正则表达式是一套强大的语法规则，用于在文本中查找、匹配和操作符合特定模式的字符串。

### **10.1 基础元字符**

这些是构成正则表达式的最基本单元。

| 元字符 | 名称 | 描述 |
| :--- | :--- | :--- |
| `.` | 点 (Dot) | 匹配**除换行符（`\n`）外**的任意单个字符。 |
| `\ ` | 反斜杠 (Backslash) | **转义**下一个字符，使其被视为普通字符（例如 `\.` 匹配点号）或特殊字符（例如 `\n` 匹配换行）。 |

### **10.2 字符集 (Character Sets)**

| 语法 | 名称 | 描述 |
| :--- | :--- | :--- |
| `[abc]` | 字符集合 | 匹配 `a`、`b`、`c` 中的任意一个字符。 |
| `[^abc]` | 否定字符集合 | 匹配**除了** `a`、`b`、`c` 之外的任意一个字符。 |
| `[a-z]` | 范围 (Range) | 匹配从 `a` 到 `z` 的任意一个小写字母。可以组合，如 `[a-zA-Z0-9]`。 |

### **10.3 预定义字符集**

为了方便使用，预定义了一些常用的字符集。

| 元字符 | 等价于 | 描述 |
| :--- | :--- | :--- |
| `\d` | `[0-9]` | 匹配任意一个**数字**。 |
| `\D` | `[^0-9]` | 匹配任意一个**非数字**字符。 |
| `\w` | `[a-zA-Z0-9_]` | 匹配任意一个**单词字符**（字母、数字、下划线）。 |
| `\W` | `[^a-zA-Z0-9_]` | 匹配任意一个**非单词字符**。 |
| `\s` | `[ \t\n\r\f\v]` | 匹配任意一个**空白字符**（空格、制表符、换行符等）。 |
| `\S` | `[^ \t\n\r\f\v]` | 匹配任意一个**非空白字符**。 |

### **10.4 定位符 / 锚点 (Anchors)**

它们不匹配任何字符，只匹配字符串中的特定**位置**。

| 元字符 | 名称 | 描述 |
| :--- | :--- | :--- |
| `^` | 开头锚点 | 匹配字符串的**开头**。（在多行模式 `m` 下，也匹配每一行的行首）。 |
| `$` | 结尾锚点 | 匹配字符串的**结尾**。（在多行模式 `m` 下，也匹配每一行的行尾）。 |
| `\b` | 单词边界 | 匹配一个单词的边界（即单词字符 `\w` 和非单词字符 `\W` 之间的位置）。 |
| `\B` | 非单词边界 | 匹配**非**单词边界的位置。 |

### **10.5 量词 (Quantifiers)**

用于指定一个模式需要重复出现的次数。

| 量词 | 模式 | 描述 |
| :--- | :--- | :--- |
| `*` | **贪婪 (Greedy)** | 匹配前面的元素**零次或多次**（尽可能多地匹配）。 |
| `*?` | **懒惰 (Lazy)** | 匹配前面的元素**零次或多次**（尽可能少地匹配）。 |
| `+` | **贪婪 (Greedy)** | 匹配前面的元素**一次或多次**（尽可能多地匹配）。 |
| `+?` | **懒惰 (Lazy)** | 匹配前面的元素**一次或多次**（尽可能少地匹配）。 |
| `?` | **贪婪 (Greedy)** | 匹配前面的元素**零次或一次**。 |
| `??` | **懒惰 (Lazy)** | 匹配前面的元素**零次或一次**。 |
| `{n}` | - | 匹配前面的元素**恰好 n 次**。 |
| `{n,}` | - | 匹配前面的元素**至少 n 次**。 |
| `{n,m}` | - | 匹配前面的元素**至少 n 次，至多 m 次**。 |

**示例 (贪婪 vs. 懒惰):**
对于字符串 `<p>one</p><p>two</p>`
- `<p>.*</p>` (贪婪) 会匹配整个字符串 `"<p>one</p><p>two</p>"`。
- `<p>.*?</p>` (懒惰) 会匹配两次，分别是 `"<p>one</p>"` 和 `"<p>two</p>"`。

### **10.6 分组与引用**

| 语法 | 名称 | 描述 |
| :--- | :--- | :--- |
| `( )` | 捕获分组 (Capturing Group) | 将括号内的表达式作为一个整体，并**捕获**其匹配内容以便后续引用。 |
| `\1`, `\2` | 反向引用 (Backreference) | 匹配与第 `n` 个捕获组**完全相同**的文本。 |
| `(?: )`| 非捕获分组 (Non-capturing Group)| 作为一个整体，但**不**捕获内容，不创建反向引用，效率更高。 |
| `\|` | 或 (Alternation) | 匹配 `|` 左边或右边的表达式。例如 `cat\|dog` 匹配 "cat" 或 "dog"。 |

### **10.7 环视 / 零宽断言 (Lookarounds)**

环视只匹配一个**位置**，它断言该位置前面或后面的内容符合某种模式，但这些内容**不会**成为最终匹配结果的一部分。

| 语法 | 名称 | 描述 |
| :--- | :--- | :--- |
| `(?=...)` | 正向前瞻 (Positive Lookahead) | 断言当前位置的**后面**能匹配 `...`。 |
| `(?!...)` | 负向前瞻 (Negative Lookahead) | 断言当前位置的**后面不能**匹配 `...`。 |
| `(?<=...)`| 正向后顾 (Positive Lookbehind) | 断言当前位置的**前面**能匹配 `...`。 |
| `(?<!...)`| 负向后顾 (Negative Lookbehind) | 断言当前位置的**前面不能**匹配 `...`。 |

![Logo](/regexpSecond.png)

### **10.8 模式修饰符 / 标志 (Flags)**

这些标志写在整个正则表达式之外（例如 `/regex/gmi`），用来改变其全局行为。

| 标志 | 名称 | 描述 |
| :--- | :--- | :--- |
| `g` | Global (全局) | 查找所有匹配项，而不是在找到第一个后就停止。 |
| `i` | Case-Insensitive (不区分大小写) | 进行忽略大小写的匹配。 |
| `m` | Multiline (多行) | 使 `^` 和 `$` 能够匹配每一行的开头和结尾。 |
| `s` | Dot All (单行) | 允许 `.` 匹配包括换行符在内的所有字符。 |

### **10.9 实用示例**

| 任务 | 正则表达式 | 解释 |
| :--- | :--- | :--- |
| **验证邮箱** | `^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$` | 检查基本的邮箱格式。 |
| **匹配手机号(中国)** | `^1[3-9]\d{9}$` | 匹配以1开头，第二位是3到9，总共11位的手机号。 |
| **匹配 URL** | `https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)` | 匹配 `http` 或 `https` 协议的网址。 |
| **匹配 IP 地址 (IPv4)** | `\b((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\b` | 匹配 0.0.0.0 到 255.255.255.255 之间的 IP 地址。 |
| **移除 HTML 标签** | `<.*?>` | **(懒惰模式)** 查找并移除 HTML/XML 标签。 |
| **查找重复的单词** | `\b(\w+)\s+\1\b` | 使用反向引用 `\1` 查找连续重复的单词。 |
| **整数千位分隔符** | `(?<=\d)(?=(\d{3})+(?!\d))` | **(使用环视)** 在需要加逗号的位置进行匹配（常用于替换操作）。 |


